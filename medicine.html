<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üìå ID Range Quiz - Medicine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script type="module" src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"></script>
  <style>
    body {
      font-family: 'Georgia', serif;
      background: #fff9e6;
      color: #4a2c2a;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #c0392b;
      text-shadow: 1px 1px 2px #fdebd0;
      font-size: 2.5em;
    }
    .input-box {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      background: #fdf5e6;
      padding: 20px;
      border-radius: 12px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    input {
      padding: 12px;
      border: 2px solid #e5b271;
      border-radius: 8px;
      background: #fefdfa;
      font-size: 1em;
      color: #4a2c2a;
    }
    input::placeholder {
      color: #bfa890;
    }
    button {
      padding: 12px 25px;
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 4px #1e8449;
      transition: all 0.1s ease-in-out;
    }
    button:hover {
      background: #2ecc71;
      transform: translateY(2px);
      box-shadow: 0 2px #1e8449;
    }
    .question-card {
      background: white;
      padding: 25px;
      margin: 10px auto;
      border-radius: 10px;
      max-width: 600px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      border: 1px solid #f0e6d2;
    }
    .option {
      margin: 10px 0;
      padding: 15px;
      background: #fdfaf5;
      border-radius: 8px;
      cursor: pointer;
      border: 1px dashed #e5b271;
      transition: background 0.2s;
    }
    .option:hover {
      background: #e8f8f5;
      border-color: #27ae60;
    }
    .option label {
      display: block;
      cursor: pointer;
    }
    .explanation {
      margin-top: 20px;
      padding: 15px;
      background: #fef5e7;
      border-left: 5px solid #f39c12;
      color: #8c6d31;
      border-radius: 0 5px 5px 0;
    }
    h3 {
      color: #c0392b;
    }
  </style>
</head>
<body>
  <h2>üç≤ Medicine Menu Quiz ü•ó</h2>
  <h3 id="studentName"></h3> <!-- ‚úÖ Added student name display -->

  <div class="input-box">
    <input type="number" id="startId" placeholder="Start ID">
    <input type="number" id="endId" placeholder="End ID">
    <button onclick="loadQuestions()">Load Questions</button>
  </div>

  <div id="quizContainer">Enter an ID range to get your first course!</div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // ‚úÖ Supabase connection
    const supabase = createClient(
      'https://iqwfqgywdtncbqhplvop.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlxd2ZxZ3l3ZHRuY2JxaHBsdm9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxNzY3ODMsImV4cCI6MjA2ODc1Mjc4M30.BlecH2Kr5Bx0q4h72EEAe7W7PiCBCTfglXJ-pQwpEvk'
    );

    // ‚úÖ Show student name if logged in
    const studentEmail = localStorage.getItem("student");
    if (!studentEmail) {
      alert("Please login first.");
      window.location.href = "index.html";
    } else {
      const nameElement = document.getElementById("studentName");
      if (nameElement) nameElement.textContent = "üë§ " + studentEmail.split("@")[0];
    }

    let questions = [];
    let currentIndex = 0;
    let score = 0;

    window.loadQuestions = async function () {
      const startId = parseInt(document.getElementById("startId").value);
      const endId = parseInt(document.getElementById("endId").value);

      if (isNaN(startId) || isNaN(endId)) {
        alert("Please enter valid numbers for your order.");
        return;
      }

      const { data, error } = await supabase
        .from("medicine")
        .select("*")
        .gte("id", startId)
        .lte("id", endId)
        .order("id", { ascending: true });

      if (error) {
        console.error(error);
        alert("Error fetching questions from the kitchen.");
        return;
      }

      if (!data.length) {
        document.getElementById("quizContainer").innerHTML = "<div class='question-card'><p>Sorry, no items found in this section of the menu.</p></div>";
        return;
      }

      questions = data;
      currentIndex = 0;
      score = 0;
      renderQuestion();
    };

    function renderQuestion() {
      const q = questions[currentIndex];
      document.getElementById("quizContainer").innerHTML = `
        <div class="question-card">
          <p><strong>Q${q.id}:</strong> ${q.question}</p>
          <div class="option"><label><input type="radio" name="opt" value="A"> A. ${q.optiona}</label></div>
          <div class="option"><label><input type="radio" name="opt" value="B"> B. ${q.optionb}</label></div>
          <div class="option"><label><input type="radio" name="opt" value="C"> C. ${q.optionc}</label></div>
          <div class="option"><label><input type="radio" name="opt" value="D"> D. ${q.optiond}</label></div>
          <button onclick="submitAnswer()">‚úÖ Serve Answer</button>
        </div>
      `;
    }

    window.submitAnswer = function () {
      const selected = document.querySelector('input[name="opt"]:checked');
      if (!selected) {
        alert("Please select an answer!");
        return;
      }

      const q = questions[currentIndex];
      const answer = selected.value;
      const isCorrect = answer === q.A; // ‚úÖ Match Supabase correct answer column

      if (isCorrect) score++;

      const explanation = q.D ? `<div class="explanation"><strong>Chef's Note:</strong> ${q.D}</div>` : "";

      document.getElementById("quizContainer").innerHTML = `
        <div class="question-card">
          <p><strong>Q${q.id}:</strong> ${q.question}</p>
          <p><strong>Your Answer:</strong> ${answer}</p>
          <p><strong>Correct Answer:</strong> ${q.A}</p>
          ${explanation}
          <button onclick="nextQuestion()">‚û°Ô∏è Next Course</button>
        </div>
      `;
    };

    window.nextQuestion = function () {
      currentIndex++;
      if (currentIndex < questions.length) {
        renderQuestion();
      } else {
        const accuracy = ((score / questions.length) * 100).toFixed(1);
        document.getElementById("quizContainer").innerHTML = `
          <div class="question-card">
            <h3>üéâ Meal Complete!</h3>
            <p>Total Dishes: ${questions.length}</p>
            <p>Correctly Answered: ${score}</p>
            <p>Taste Accuracy: ${accuracy}%</p>
          </div>
        `;
      }
    };
  </script>
</body>
</html>