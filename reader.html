<!DOCTYPE html>  <html lang="en">  
<head>  
  <meta charset="UTF-8" />  
  <title>📖 Book Reader with Supabase</title>  
  <script type="module">  
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";  const supabaseUrl = 'https://iqwfqgywdtncbqhplvop.supabase.co';  
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlxd2ZxZ3l3ZHRuY2JxaHBsdm9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxNzY3ODMsImV4cCI6MjA2ODc1Mjc4M30.BlecH2Kr5Bx0q4h72EEAe7W7PiCBCTfglXJ-pQwpEvk';  
const supabase = createClient(supabaseUrl, supabaseKey);  

const subjectSelect = document.getElementById('subjectSelect');  
const contentContainer = document.getElementById('contentContainer');  
const pageNumberSpan = document.getElementById('pageNumber');  
const saveHighlightBtn = document.getElementById('saveHighlightBtn');  

const highlightBtn = document.getElementById('highlightBtn');  
const prevBtn = document.getElementById('prevBtn');  
const nextBtn = document.getElementById('nextBtn');  

let pages = [];  
let currentPageIndex = 0;  
let currentSubject = '';  

// Load subjects on start  
loadSubjects();  

async function loadSubjects() {  
  const { data, error } = await supabase  
    .from('book_pages')  
    .select('subject')  
    .neq('subject', null);  

  if (error) {  
    alert("Error loading subjects: " + error.message);  
    return;  
  }  

  const uniqueSubjects = [...new Set(data.map(d => d.subject))];  
  uniqueSubjects.forEach(subj => {  
    const opt = document.createElement('option');  
    opt.value = subj;  
    opt.textContent = subj;  
    subjectSelect.appendChild(opt);  
  });  
}  

subjectSelect.addEventListener('change', async function () {  
  currentSubject = subjectSelect.value;  
  if (!currentSubject) return;  

  const { data, error } = await supabase  
    .from('book_pages')  
    .select('*')  
    .eq('subject', currentSubject)  
    .order('page_no', { ascending: true });  

  if (error) {  
    alert("Error loading pages: " + error.message);  
    return;  
  }  

  pages = data;  
  currentPageIndex = 0;  
  showPage();       
});  

function showPage() {  
  if (pages.length === 0) {  
    contentContainer.innerHTML = "No pages available.";  
    return;  
  }  

  contentContainer.innerHTML = pages[currentPageIndex].content;  
  pageNumberSpan.textContent = pages[currentPageIndex].page_no;  
  const ID = pages[currentPageIndex].id;  
  saveHighlightBtn.style.display = 'none';  
}  

function nextPage() {  
  if (currentPageIndex < pages.length - 1) {  
    currentPageIndex++;  
    showPage();  
  }  
}  

function prevPage() {  
  if (currentPageIndex > 0) {  
    currentPageIndex--;  
    showPage();  
  }  
}  

function highlightSelection() {  
  const selection = window.getSelection();  
  if (!selection.rangeCount) return;  

  const range = selection.getRangeAt(0);  
  if (range.collapsed) return;  

  const selectedText = range.extractContents();  
  const mark = document.createElement("mark");  
  mark.appendChild(selectedText);  
  range.insertNode(mark);  

  saveHighlightBtn.style.display = 'block';  
}  

async function saveHighlight() {  
  const highlights = contentContainer.querySelectorAll('mark');  
  const lastHighlight = highlights[highlights.length - 1];  
  if (!lastHighlight) return;  

  const highlightText = lastHighlight.textContent.trim();  
  const pageNo = pages[currentPageIndex].page_no;  
  const ID = pages[currentPageIndex].id;  

  const { error } = await supabase.from('highlights').insert({  
    subject: currentSubject,  
    id: ID,  
    page_no: pageNo,  
    highlight_content: highlightText  
  });  

  if (error) {  
    alert("Error saving highlight: " + error.message);  
    return;  
  }  

  alert(`✅ Saved highlight on "${currentSubject}" page ${pageNo}:\n"${highlightText}"`);  
  saveHighlightBtn.style.display = 'none';  
}  

// ✅ Add event listeners  
highlightBtn.addEventListener('click', highlightSelection);  
prevBtn.addEventListener('click', prevPage);  
nextBtn.addEventListener('click', nextPage);  
saveHighlightBtn.addEventListener('click', saveHighlight);
  
  
  const jumpPageInput = document.getElementById('jumpPageInput');
const jumpPageBtn = document.getElementById('jumpPageBtn');

jumpPageBtn.addEventListener('click', () => {
  const pageNumber = parseInt(jumpPageInput.value);
  if (isNaN(pageNumber)) {
    alert("❌ Please enter a valid page number.");
    return;
  }

  const targetIndex = pages.findIndex(p => p.page_no === pageNumber);
  if (targetIndex === -1) {
    alert(`❌ Page ${pageNumber} not found in subject "${currentSubject}".`);
    return;
  }

  currentPageIndex = targetIndex;
  showPage();
});

  
  
  // === 🔍 SEARCH FUNCTIONALITY ===
const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');
const searchResultsDiv = document.getElementById('searchResults');

searchBtn.addEventListener('click', async () => {
  const keyword = searchInput.value.trim();
  if (!keyword || !currentSubject) {
    alert("❌ Please enter a keyword and select a subject.");
    return;
  }

  const { data, error } = await supabase
    .from('book_pages')
    .select('page_no, content')
    .eq('subject', currentSubject);

  if (error) {
    alert("❌ Error searching pages: " + error.message);
    return;
  }

  const matchingPages = data.filter(p => p.content.toLowerCase().includes(keyword.toLowerCase()));

  if (matchingPages.length === 0) {
    searchResultsDiv.innerHTML = `<p>No results found for "<strong>${keyword}</strong>"</p>`;
    return;
  }

  searchResultsDiv.innerHTML = `<h4>Results for "<strong>${keyword}</strong>":</h4>`;
  matchingPages.forEach(p => {
    const btn = document.createElement('button');
    btn.textContent = `Page ${p.page_no}`;
    btn.addEventListener('click', () => {
      const idx = pages.findIndex(pg => pg.page_no === p.page_no);
      if (idx !== -1) {
        currentPageIndex = idx;
        showPage();
        searchResultsDiv.scrollIntoView({ behavior: 'smooth' });
      }
    });
    searchResultsDiv.appendChild(btn);
  });
});
  
  
  
  
  
  
  
  </script>    <style>  
  body {   
    font-family: Arial;   
    margin: 20px;   
  }  
  
  #contentContainer {  
    border: 2px solid #333;  
    padding: 20px;  
    min-height: 300px;  
    white-space: pre-wrap;  
    font-size: 35px;        /* 📌 VERY BIG LETTERS */  
    line-height: 2;       /* 📌 MORE GAP BETWEEN LINES */  
  }  
  
  mark {   
    background-color: yellow;   
  }  
  
  .floating-btn {  
    display: none;  
    position: fixed;  
    bottom: 30px;  
    right: 30px;  
    background-color: #28a745;  
    color: white;  
    padding: 12px 18px;  
    border-radius: 50px;  
    border: none;  
    cursor: pointer;  
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);  
  }  
  
  button {  
    margin: 10px 5px;  
    padding: 10px 15px;  
  }  
</style>  </head>  
<body>  
  <h2>📚 Subject Reader (Connected to Supabase)</h2>  <label for="subjectSelect">Choose Subject:</label>
<select id="subjectSelect">
<option value="">--Select--</option>
</select>

  <h3>📄 Page <span id="pageNumber">1</span></h3>  
  <div id="contentContainer" contenteditable="true"></div>  <button id="highlightBtn">✨ Highlight</button>
<button id="prevBtn">⬅ Previous</button>
<button id="nextBtn">Next ➡</button>
  <div style="margin-top: 10px;">
  <input type="number" id="jumpPageInput" placeholder="Enter page #" min="1" style="width: 100px;" />
  <button id="jumpPageBtn">🔢 Jump</button>
    <hr />
<h3>🔍 Search in Current Subject</h3>
<input type="text" id="searchInput" placeholder="Enter keyword to search..." style="width: 60%; padding: 5px;" />
<button id="searchBtn">🔍 Search</button>

<div id="searchResults" style="margin-top: 15px;"></div>
</div>

<button id="saveHighlightBtn" class="floating-btn">💾 Save Highlight</button>

</body>  
</html>  

